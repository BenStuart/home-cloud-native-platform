---

- name: "Create directory for configuration at {{ traefik.storage }}"
  file:
    path: "{{ traefik.storage }}"
    state: directory

- name: Copy configuration files
  template:
    # src: traefik-consul.toml.j2
    # src: traefik-do.toml.j2
    # src: traefik-docker.toml.j2
    src: traefik.toml.j2
    dest: "{{ traefik.storage }}/traefik.toml"
    backup: yes

- name: Create file for Let's Encrypt information
  file:
    path: "{{ traefik.storage }}/acme.json"
    state: touch
    mode: 0600
  when: 0
  
- name: Create traefik front page
  template:
    src: index.html.j2
    dest: "{{ traefik.storage }}/html/index.html"

- name: Create configuration
  template:
    src: traefik-consul.toml.j2
    dest: "{{ traefik.storage }}/traefik.toml"
