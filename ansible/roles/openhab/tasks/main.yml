---

# sudo useradd -r -s /sbin/nologin openhab
- name: Create user
  become: true
  user:
    name: "{{ openhab.user }}"
    create_home: no
    system: yes
    shell: /sbin/nologin

# usermod -a -G openhab <user>
- name: Add user to openhab group
  become: true
  user:
    name: "{{ ansible_user }}"
    groups: "{{ openhab.group }}"
    append: yes

# Create directories
- name: Create base directories
  become: true
  file:
    name: "{{ openhab.directories.base }}"
    state: directory
    owner: "{{ openhab.user }}"
    group: "{{ openhab.group }}"
    mode: 0755

# Create data directories
- name: Create data directories
  become: true
  file:
    name: "{{ openhab.directories.base }}/{{ item }}"
    state: directory
    owner: "{{ openhab.user }}"
    group: "{{ openhab.group }}"
    mode: 0755
  loop: "{{ openhab.directories.data }}"

  # Run openhab container